Return-Path: <linux-security-module+bounces-13973-lists+linux-security-module=lfdr.de@vger.kernel.org>
X-Original-To: lists+linux-security-module@lfdr.de
Delivered-To: lists+linux-security-module@lfdr.de
Received: from tor.lore.kernel.org (tor.lore.kernel.org [172.105.105.114])
	by mail.lfdr.de (Postfix) with ESMTPS id DAA7ED1F998
	for <lists+linux-security-module@lfdr.de>; Wed, 14 Jan 2026 16:04:51 +0100 (CET)
Received: from smtp.subspace.kernel.org (conduit.subspace.kernel.org [100.90.174.1])
	by tor.lore.kernel.org (Postfix) with ESMTP id 9E41D3045D98
	for <lists+linux-security-module@lfdr.de>; Wed, 14 Jan 2026 15:02:38 +0000 (UTC)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id 47B3030EF7F;
	Wed, 14 Jan 2026 15:02:38 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b="QzO8n8GL"
X-Original-To: linux-security-module@vger.kernel.org
Received: from smtp.kernel.org (aws-us-west-2-korg-mail-1.web.codeaurora.org [10.30.226.201])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 221143043DC;
	Wed, 14 Jan 2026 15:02:37 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=10.30.226.201
ARC-Seal:i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1768402958; cv=none; b=XVjO277spnuU9oVhdZ+MHxMVEpHxTlTZM24sdPRHM5iDMKxn7Oq7OrDwtU2kO6OOw8nUXMzjBXsGgA5ao8D6o4YTGBYqutq4V1ut78U8TsGe9STIagBJ0v9wDdRoZktY2EeQlXMgl8DJ6/wc86qxikG3rAiRx5TzipgFzY/NstI=
ARC-Message-Signature:i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1768402958; c=relaxed/simple;
	bh=IrXNkb7+O2a5FS75Ce6sMiMpoMJuAOMDHFUCS2UIwZc=;
	h=Date:From:To:Cc:Subject:Message-ID:References:MIME-Version:
	 Content-Type:Content-Disposition:In-Reply-To; b=ZwqVgts7vjXlanS34VBf8HaRiacLkRsFoew7lbVbhOvKHbb8Sf7CY7CYrEKGnJwq87NNlpNv6aiDopBvhQEjExTarbnUFLq7Pm7ZFYdcGXt0rIP/eE6PFyJoWUrQNhM+7ETJa/zcFj/Y8QSg9HnaeVB7ziCkfLLKPXFS9FeElF4=
ARC-Authentication-Results:i=1; smtp.subspace.kernel.org; dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b=QzO8n8GL; arc=none smtp.client-ip=10.30.226.201
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 296D5C4CEF7;
	Wed, 14 Jan 2026 15:02:36 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
	s=k20201202; t=1768402957;
	bh=IrXNkb7+O2a5FS75Ce6sMiMpoMJuAOMDHFUCS2UIwZc=;
	h=Date:From:To:Cc:Subject:References:In-Reply-To:From;
	b=QzO8n8GLwApQr1TsVGAtRowdTala4QPCk1ENrMhWOgOZSPnTGkjv942Gy3fmt7cMG
	 r5tgmpzZCAhhOarHpcR/met3QGyLEf1Iwj8uZc58gQH3caxqRjveSurHY+EnYYMIz/
	 lwPLam3NMP09Vk9CAbuIUru/JM35JEWSVdZfpKLwWz8jGv1pUBh+CrVseDwgjkcpwf
	 QPDGhr+361HEzhxXVSEByzdp5eXak9QfePlFGZ+TNXSnRT30dThnI53zMD/ufDS5o0
	 58/qW/4x7icNXc1peB7qbeyhNXIzdXWyq5J2aN6diuMVxjMbW44ERpRo3I9s1wP/fF
	 FFu+I+3LwlG1w==
Date: Wed, 14 Jan 2026 17:02:32 +0200
From: Jarkko Sakkinen <jarkko@kernel.org>
To: Srish Srinivasan <ssrish@linux.ibm.com>
Cc: linux-integrity@vger.kernel.org, keyrings@vger.kernel.org,
	linuxppc-dev@lists.ozlabs.org, maddy@linux.ibm.com,
	mpe@ellerman.id.au, npiggin@gmail.com, christophe.leroy@csgroup.eu,
	James.Bottomley@hansenpartnership.com, zohar@linux.ibm.com,
	nayna@linux.ibm.com, rnsastry@linux.ibm.com,
	linux-kernel@vger.kernel.org, linux-security-module@vger.kernel.org
Subject: Re: [PATCH v3 5/6] keys/trusted_keys: establish PKWM as a trusted
 source
Message-ID: <aWewCEy3wT-1a6zn@kernel.org>
References: <20260106150527.446525-1-ssrish@linux.ibm.com>
 <20260106150527.446525-6-ssrish@linux.ibm.com>
 <aV-w2NbxAPuuXy_U@kernel.org>
 <b5086ef7-6f4c-4e4c-81d2-a6a663ee891e@linux.ibm.com>
Precedence: bulk
X-Mailing-List: linux-security-module@vger.kernel.org
List-Id: <linux-security-module.vger.kernel.org>
List-Subscribe: <mailto:linux-security-module+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-security-module+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <b5086ef7-6f4c-4e4c-81d2-a6a663ee891e@linux.ibm.com>

On Fri, Jan 09, 2026 at 02:17:52PM +0530, Srish Srinivasan wrote:
> Hi Jarkko,
> thank you for taking a look.
> 
> On 1/8/26 6:57 PM, Jarkko Sakkinen wrote:
> > On Tue, Jan 06, 2026 at 08:35:26PM +0530, Srish Srinivasan wrote:
> > > The wrapping key does not exist by default and is generated by the
> > > hypervisor as a part of PKWM initialization. This key is then persisted by
> > > the hypervisor and is used to wrap trusted keys. These are variable length
> > > symmetric keys, which in the case of PowerVM Key Wrapping Module (PKWM) are
> > > generated using the kernel RNG. PKWM can be used as a trust source through
> > > the following example keyctl commands:
> > > 
> > > keyctl add trusted my_trusted_key "new 32" @u
> > > 
> > > Use the wrap_flags command option to set the secure boot requirement for
> > > the wrapping request through the following keyctl commands
> > > 
> > > case1: no secure boot requirement. (default)
> > > keyctl usage: keyctl add trusted my_trusted_key "new 32" @u
> > > 	      OR
> > > 	      keyctl add trusted my_trusted_key "new 32 wrap_flags=0x00" @u
> > > 
> > > case2: secure boot required to in either audit or enforce mode. set bit 0
> > > keyctl usage: keyctl add trusted my_trusted_key "new 32 wrap_flags=0x01" @u
> > > 
> > > case3: secure boot required to be in enforce mode. set bit 1
> > > keyctl usage: keyctl add trusted my_trusted_key "new 32 wrap_flags=0x02" @u
> > > 
> > > NOTE:
> > > -> Setting the secure boot requirement is NOT a must.
> > > -> Only either of the secure boot requirement options should be set. Not
> > > both.
> > > -> All the other bits are required to be not set.
> > > -> Set the kernel parameter trusted.source=pkwm to choose PKWM as the
> > > backend for trusted keys implementation.
> > > -> CONFIG_PSERIES_PLPKS must be enabled to build PKWM.
> > > 
> > > Add PKWM, which is a combination of IBM PowerVM and Power LPAR Platform
> > > KeyStore, as a new trust source for trusted keys.
> > > 
> > > Signed-off-by: Srish Srinivasan <ssrish@linux.ibm.com>
> > > Reviewed-by: Mimi Zohar <zohar@linux.ibm.com>
> > > ---
> > >   MAINTAINERS                               |   9 ++
> > >   include/keys/trusted-type.h               |   7 +-
> > >   include/keys/trusted_pkwm.h               |  22 +++
> > >   security/keys/trusted-keys/Kconfig        |   8 ++
> > >   security/keys/trusted-keys/Makefile       |   2 +
> > >   security/keys/trusted-keys/trusted_core.c |   6 +-
> > >   security/keys/trusted-keys/trusted_pkwm.c | 168 ++++++++++++++++++++++
> > >   7 files changed, 220 insertions(+), 2 deletions(-)
> > >   create mode 100644 include/keys/trusted_pkwm.h
> > >   create mode 100644 security/keys/trusted-keys/trusted_pkwm.c
> > > 
> > > diff --git a/MAINTAINERS b/MAINTAINERS
> > > index a0dd762f5648..ba51eff21a16 100644
> > > --- a/MAINTAINERS
> > > +++ b/MAINTAINERS
> > > @@ -14003,6 +14003,15 @@ S:	Supported
> > >   F:	include/keys/trusted_dcp.h
> > >   F:	security/keys/trusted-keys/trusted_dcp.c
> > > +KEYS-TRUSTED-PLPKS
> > > +M:	Srish Srinivasan <ssrish@linux.ibm.com>
> > > +M:	Nayna Jain <nayna@linux.ibm.com>
> > > +L:	linux-integrity@vger.kernel.org
> > > +L:	keyrings@vger.kernel.org
> > > +S:	Supported
> > > +F:	include/keys/trusted_plpks.h
> > > +F:	security/keys/trusted-keys/trusted_pkwm.c
> > > +
> > >   KEYS-TRUSTED-TEE
> > >   M:	Sumit Garg <sumit.garg@kernel.org>
> > >   L:	linux-integrity@vger.kernel.org
> > > diff --git a/include/keys/trusted-type.h b/include/keys/trusted-type.h
> > > index 4eb64548a74f..45c6c538df22 100644
> > > --- a/include/keys/trusted-type.h
> > > +++ b/include/keys/trusted-type.h
> > > @@ -19,7 +19,11 @@
> > >   #define MIN_KEY_SIZE			32
> > >   #define MAX_KEY_SIZE			128
> > > -#define MAX_BLOB_SIZE			512
> > > +#if IS_ENABLED(CONFIG_TRUSTED_KEYS_PKWM)
> > > +#define MAX_BLOB_SIZE			1152
> > > +#else
> > > +#define MAX_BLOB_SIZE                   512
> > > +#endif
> > >   #define MAX_PCRINFO_SIZE		64
> > >   #define MAX_DIGEST_SIZE			64
> > > @@ -46,6 +50,7 @@ struct trusted_key_options {
> > >   	uint32_t policydigest_len;
> > >   	unsigned char policydigest[MAX_DIGEST_SIZE];
> > >   	uint32_t policyhandle;
> > > +	uint16_t wrap_flags;
> > >   };
> > We should introduce:
> > 
> > 	void *private;
> > 
> > And hold backend specific fields there.
> > 
> > This patch set does not necessarily have to migrate TPM fields to this
> > new framework, only start a better convention before this turns into
> > a chaos.
> 
> 
> Sure,
> thanks for bringing this up.
> I will make the required changes in my next version.

Great! TPM fields are where they are more like through history and
evolution than by design. While not required, of course migrating
also them is a most welcome additional patch :-)

BR, Jarkko

